# AI Chat - Anthropic Claude APIãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆ

Anthropic Claude APIã‚’ä½¿ç”¨ã—ãŸä¸€èˆ¬çš„ãªä¼šè©±ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã€‚Next.js App Routerã€Honoã€Prismaã€Mastraãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’æ´»ç”¨ã—ãŸã€ãƒ¢ãƒ€ãƒ³ã§æ‹¡å¼µæ€§ã®é«˜ã„ãƒ•ãƒ«ã‚¹ã‚¿ãƒƒã‚¯Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™ã€‚

## âœ¨ ä¸»è¦æ©Ÿèƒ½

- ğŸ¤– **AIãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½** - Claude APIã«ã‚ˆã‚‹ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ä¼šè©±
- ğŸ’¬ **ä¼šè©±å±¥æ­´ç®¡ç†** - MongoDBã«ã‚ˆã‚‹ä¼šè©±ã®ä¿å­˜ãƒ»ç®¡ç†
- ğŸŒ“ **ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰å¯¾å¿œ** - ã‚·ã‚¹ãƒ†ãƒ è¨­å®šé€£å‹• & æ‰‹å‹•åˆ‡ã‚Šæ›¿ãˆ
- ğŸ“± **ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³** - ãƒ¢ãƒã‚¤ãƒ«ãƒ»ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆãƒ»ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—å¯¾å¿œ
- ğŸ¨ **Markdownãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°** - ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã®ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ãƒã‚¤ãƒ©ã‚¤ãƒˆ
- âš¡ **é«˜é€Ÿãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹** - Next.js 15ã®æœ€æ–°æ©Ÿèƒ½ã‚’æ´»ç”¨

## ğŸ› ï¸ æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
- **Next.js 15** (App Router)
- **React 19**
- **TypeScript** (strict mode)
- **Tailwind CSS**
- **shadcn/ui** ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- **next-themes** (ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰)

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
- **Hono** - è»½é‡é«˜é€ŸãªWebãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯
- **Prisma** - å‹å®‰å…¨ãªORM
- **MongoDB** - NoSQLãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
- **Mastra** - AIçµ±åˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯
- **Anthropic Claude API** - AIãƒ¢ãƒ‡ãƒ«

### é–‹ç™ºãƒ»ãƒ†ã‚¹ãƒˆ
- **Vitest** - ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ
- **Playwright** - E2Eãƒ†ã‚¹ãƒˆ
- **ESLint** & **Prettier** - ã‚³ãƒ¼ãƒ‰å“è³ªç®¡ç†

### ãƒ‡ãƒ—ãƒ­ã‚¤
- **Docker** - ã‚³ãƒ³ãƒ†ãƒŠåŒ–
- **Google Cloud Run** - ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ãƒ‡ãƒ—ãƒ­ã‚¤
- **GitHub Actions** - CI/CD

## ğŸ“‹ å‰ææ¡ä»¶

- Node.js 20.xä»¥ä¸Š
- npm ã¾ãŸã¯ pnpm
- Docker Desktop (ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç”¨)
- MongoDB (ãƒ­ãƒ¼ã‚«ãƒ«) ã¾ãŸã¯ MongoDB Atlas (æœ¬ç•ª)
- Anthropic API ã‚­ãƒ¼

## ğŸš€ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### 1. ãƒªãƒã‚¸ãƒˆãƒªã®ã‚¯ãƒ­ãƒ¼ãƒ³

```bash
git clone <repository-url>
cd ai-chat
```

### 2. ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
npm install
```

### 3. ç’°å¢ƒå¤‰æ•°ã®è¨­å®š

`.env.example`ã‚’`.env`ã«ã‚³ãƒ”ãƒ¼ã—ã¦ã€å¿…è¦ãªå€¤ã‚’è¨­å®šï¼š

```bash
cp .env.example .env
```

`.env`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†ï¼š

```env
DATABASE_URL="mongodb://localhost:27017/ai-chat"
ANTHROPIC_API_KEY="your-api-key-here"
NEXT_PUBLIC_APP_URL="http://localhost:3000"
NODE_ENV="development"
```

### 4. MongoDBã®èµ·å‹•ï¼ˆDockerä½¿ç”¨ï¼‰

**Replica Setã¨ã—ã¦èµ·å‹•ï¼ˆæ¨å¥¨ï¼‰:**

```bash
# MongoDBã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•
docker run -d -p 27017:27017 --name mongodb mongo:latest --replSet rs0

# Replica Setã‚’åˆæœŸåŒ–
docker exec mongodb mongosh --eval "rs.initiate({_id: 'rs0', members: [{_id: 0, host: 'localhost:27017'}]})"
```

### 5. Prismaã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

```bash
# Prisma Clientã®ç”Ÿæˆ
npx prisma generate

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒã®ãƒ—ãƒƒã‚·ãƒ¥
npx prisma db push
```

### 6. é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã®èµ·å‹•

```bash
npm run dev
```

ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒ http://localhost:3000 ã§èµ·å‹•ã—ã¾ã™ã€‚

## ğŸ§ª ãƒ†ã‚¹ãƒˆ

### ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ

```bash
npm run test
```

### E2Eãƒ†ã‚¹ãƒˆ

```bash
# MongoDB Replica SetãŒèµ·å‹•ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
npm run test:e2e
```

### ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸

```bash
npm run test:coverage
```

## ğŸ³ Docker

### ãƒ­ãƒ¼ã‚«ãƒ«ã§ã®Dockerãƒ“ãƒ«ãƒ‰

```bash
# ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ“ãƒ«ãƒ‰
docker build -f docker/Dockerfile -t ai-chat .

# ã‚³ãƒ³ãƒ†ãƒŠã®èµ·å‹•
docker run -p 3000:3000 \
  -e DATABASE_URL="your-mongodb-url" \
  -e ANTHROPIC_API_KEY="your-api-key" \
  ai-chat
```

## â˜ï¸ Google Cloud Runã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤

### å‰ææ¡ä»¶

1. Google Cloud Projectã®ä½œæˆ
2. gcloud CLIã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨èªè¨¼
3. Cloud Run APIã®æœ‰åŠ¹åŒ–
4. Secret Managerã¸ã®ç’°å¢ƒå¤‰æ•°ç™»éŒ²

### Secret Managerã¸ã®ç™»éŒ²

```bash
# APIã‚­ãƒ¼ã®ç™»éŒ²
echo -n "your-anthropic-api-key" | gcloud secrets create ANTHROPIC_API_KEY --data-file=-

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹URLã®ç™»éŒ²
echo -n "your-mongodb-atlas-url" | gcloud secrets create DATABASE_URL --data-file=-
```

### Cloud Buildã§ã®ãƒ‡ãƒ—ãƒ­ã‚¤

```bash
gcloud builds submit --config=cloudbuild.yaml
```

### GitHub Actionsã§ã®ãƒ‡ãƒ—ãƒ­ã‚¤

1. GitHubãƒªãƒã‚¸ãƒˆãƒªã®Secretsã«ä»¥ä¸‹ã‚’è¨­å®šï¼š
   - `GCP_PROJECT_ID`
   - `GCP_WORKLOAD_IDENTITY_PROVIDER`
   - `GCP_SERVICE_ACCOUNT`
   - `ANTHROPIC_API_KEY` (ãƒ†ã‚¹ãƒˆç”¨)

2. `main`ãƒ–ãƒ©ãƒ³ãƒã«ãƒ—ãƒƒã‚·ãƒ¥ã™ã‚‹ã¨è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã¾ã™

## ğŸ“ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 

```
ai-chat/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/                    # Next.js App Router
â”‚   â”‚   â”œâ”€â”€ api/               # API Routes (Hono)
â”‚   â”‚   â”œâ”€â”€ chat/              # ãƒãƒ£ãƒƒãƒˆç”»é¢
â”‚   â”‚   â””â”€â”€ layout.tsx         # ãƒ«ãƒ¼ãƒˆãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
â”‚   â”œâ”€â”€ components/            # Reactã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”œâ”€â”€ chat/             # ãƒãƒ£ãƒƒãƒˆé–¢é€£
â”‚   â”‚   â”œâ”€â”€ ui/               # å…±é€šUI
â”‚   â”‚   â””â”€â”€ providers/        # Context Providers
â”‚   â”œâ”€â”€ hooks/                # ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯
â”‚   â”œâ”€â”€ lib/                  # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”‚   â”‚   â”œâ”€â”€ api/             # APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
â”‚   â”‚   â”œâ”€â”€ mastra/          # Mastraè¨­å®š
â”‚   â”‚   â””â”€â”€ prisma.ts        # Prisma Client
â”‚   â”œâ”€â”€ server/              # ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒ­ã‚¸ãƒƒã‚¯
â”‚   â”‚   â”œâ”€â”€ api/            # Hono APIãƒãƒ³ãƒ‰ãƒ©ãƒ¼
â”‚   â”‚   â”œâ”€â”€ services/       # ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
â”‚   â”‚   â””â”€â”€ middleware/     # ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢
â”‚   â””â”€â”€ types/              # TypeScriptå‹å®šç¾©
â”œâ”€â”€ prisma/
â”‚   â””â”€â”€ schema.prisma       # Prismaã‚¹ã‚­ãƒ¼ãƒ
â”œâ”€â”€ tests/                 # ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«
â”‚   â”œâ”€â”€ unit/             # ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ
â”‚   â”œâ”€â”€ integration/      # çµ±åˆãƒ†ã‚¹ãƒˆ
â”‚   â””â”€â”€ e2e/              # E2Eãƒ†ã‚¹ãƒˆ
â”œâ”€â”€ docker/
â”‚   â””â”€â”€ Dockerfile        # Dockerãƒ•ã‚¡ã‚¤ãƒ«
â””â”€â”€ .github/
    â””â”€â”€ workflows/        # GitHub Actions
```

## ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

- ç’°å¢ƒå¤‰æ•°ã®é©åˆ‡ãªç®¡ç†
- XSSå¯¾ç­–ï¼ˆReactã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæ©Ÿèƒ½ï¼‰
- MongoDB injectionå¯¾ç­–ï¼ˆPrismaä½¿ç”¨ï¼‰
- HTTPSå¼·åˆ¶ï¼ˆCloud Runï¼‰
- APIå…¥åŠ›å€¤ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆZodï¼‰

## ğŸ“ é–‹ç™ºã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

### ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„

- TypeScript strict modeä½¿ç”¨
- ESLintã¨Prettierã§ã‚³ãƒ¼ãƒ‰å“è³ªç®¡ç†
- Conventional Commitså½¢å¼ã®ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
- å˜ä¸€è²¬ä»»ã®åŸå‰‡ã«å¾“ã£ãŸé–¢æ•°è¨­è¨ˆ

### Gitã‚³ãƒŸãƒƒãƒˆä¾‹

```bash
feat: æ–°æ©Ÿèƒ½ã®è¿½åŠ 
fix: ãƒã‚°ä¿®æ­£
docs: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°
style: ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
refactor: ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
test: ãƒ†ã‚¹ãƒˆè¿½åŠ ãƒ»ä¿®æ­£
chore: ãã®ä»–ã®å¤‰æ›´
```

## ğŸ¤ ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³

1. ã“ã®ãƒªãƒã‚¸ãƒˆãƒªã‚’ãƒ•ã‚©ãƒ¼ã‚¯
2. æ–°ã—ã„ãƒ–ãƒ©ãƒ³ãƒã‚’ä½œæˆ (`git checkout -b feature/amazing-feature`)
3. å¤‰æ›´ã‚’ã‚³ãƒŸãƒƒãƒˆ (`git commit -m 'feat: Add amazing feature'`)
4. ãƒ–ãƒ©ãƒ³ãƒã«ãƒ—ãƒƒã‚·ãƒ¥ (`git push origin feature/amazing-feature`)
5. ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ä½œæˆ

## ğŸ“„ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯MITãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã®ä¸‹ã§å…¬é–‹ã•ã‚Œã¦ã„ã¾ã™ã€‚

## ğŸ™ è¬è¾

- [Anthropic](https://www.anthropic.com/) - Claude API
- [Vercel](https://vercel.com/) - Next.js
- [Mastra](https://mastra.ai/) - AIãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯
- [Hono](https://hono.dev/) - Webãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯
- [Prisma](https://www.prisma.io/) - ORM

## ğŸ“® ã‚µãƒãƒ¼ãƒˆ

å•é¡ŒãŒç™ºç”Ÿã—ãŸå ´åˆã¯ã€GitHubã®Issuesã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§å ±å‘Šã—ã¦ãã ã•ã„ã€‚

---

**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0.0
**æœ€çµ‚æ›´æ–°**: 2025-12-11
